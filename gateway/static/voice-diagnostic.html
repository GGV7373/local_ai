<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Feature Diagnostic</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f0f1a;
            color: #e0e0e0;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .container {
            background: #1a1a2e;
            border: 1px solid #3a3a5a;
            border-radius: 12px;
            padding: 30px;
        }
        h1 { color: #00d9ff; margin-bottom: 20px; }
        h2 { color: #00d9ff; margin-top: 20px; margin-bottom: 10px; }
        .test-item {
            background: #252545;
            border: 1px solid #3a3a5a;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .status {
            padding: 10px 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: 500;
        }
        .status.success { background: rgba(46, 213, 115, 0.2); color: #2ed573; }
        .status.error { background: rgba(255, 71, 87, 0.2); color: #ff4757; }
        .status.warning { background: rgba(255, 165, 2, 0.2); color: #ffa502; }
        .status.info { background: rgba(0, 217, 255, 0.2); color: #00d9ff; }
        button {
            background: #00d9ff;
            color: #0f0f1a;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover { background: #00ff88; }
        button:disabled { background: #666; cursor: not-allowed; opacity: 0.5; }
        .output {
            background: #0f0f1a;
            border: 1px solid #3a3a5a;
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 6px;
        }
        code { background: #252545; padding: 2px 6px; border-radius: 3px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé§ Voice Feature Diagnostic Tool</h1>
        <p>Use this tool to test if your browser and network support the voice feature.</p>

        <!-- Test 1: Browser Support -->
        <div class="test-item">
            <h2>1Ô∏è‚É£ Browser Support</h2>
            <p>Check if your browser supports Web Speech API:</p>
            <button onclick="testBrowserSupport()">Test Browser Support</button>
            <div id="browserResult"></div>
        </div>

        <!-- Test 2: Microphone -->
        <div class="test-item">
            <h2>2Ô∏è‚É£ Microphone Access</h2>
            <p>Check if browser can detect microphone:</p>
            <button onclick="testMicrophone()">Test Microphone</button>
            <div id="micResult"></div>
        </div>

        <!-- Test 3: Internet Connection -->
        <div class="test-item">
            <h2>3Ô∏è‚É£ Internet Connection</h2>
            <p>Check if you can reach Google's speech recognition servers:</p>
            <button onclick="testInternet()">Test Connection</button>
            <div id="internetResult"></div>
        </div>

        <!-- Test 4: Speech Recognition -->
        <div class="test-item">
            <h2>4Ô∏è‚É£ Speech Recognition</h2>
            <p>Test actual speech recognition (speak something):</p>
            <button id="speechBtn" onclick="testSpeechRecognition()">Start Speech Test</button>
            <div id="speechResult"></div>
            <div class="output" id="speechOutput" style="display: none;"></div>
        </div>

        <!-- Test Results Summary -->
        <div class="test-item">
            <h2>üìã Summary</h2>
            <div id="summary"></div>
        </div>
    </div>

    <script>
        const results = {
            browser: null,
            microphone: null,
            internet: null,
            speech: null
        };

        function updateSummary() {
            const summary = document.getElementById('summary');
            const passed = Object.values(results).filter(r => r === true).length;
            const total = Object.keys(results).length;
            
            let html = `<div class="status info">Passed: ${passed}/${total}</div>`;
            
            if (passed === total) {
                html += '<div class="status success">‚úÖ All tests passed! Voice feature should work.</div>';
            } else {
                html += '<div class="status warning">‚ö†Ô∏è Some tests failed. See details above.</div>';
            }
            
            summary.innerHTML = html;
        }

        function testBrowserSupport() {
            const result = document.getElementById('browserResult');
            const supported = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            if (supported) {
                result.innerHTML = '<div class="status success">‚úÖ Browser supports Web Speech API</div>';
                results.browser = true;
            } else {
                result.innerHTML = '<div class="status error">‚ùå Browser does NOT support Web Speech API<br/>Try Chrome, Edge, Safari, or Firefox</div>';
                results.browser = false;
            }
            updateSummary();
        }

        function testMicrophone() {
            const result = document.getElementById('micResult');
            result.innerHTML = '<div class="status info">Checking microphone...</div>';
            
            if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {
                result.innerHTML = '<div class="status error">‚ùå Cannot access microphone API</div>';
                results.microphone = false;
                updateSummary();
                return;
            }

            navigator.mediaDevices.enumerateDevices()
                .then(devices => {
                    const audioInput = devices.filter(d => d.kind === 'audioinput');
                    if (audioInput.length > 0) {
                        let html = '<div class="status success">‚úÖ Found ' + audioInput.length + ' microphone(s)</div>';
                        audioInput.forEach((d, i) => {
                            html += '<div style="margin: 5px 0; font-size: 0.9rem;">' + (i+1) + '. ' + (d.label || 'Unnamed Device') + '</div>';
                        });
                        result.innerHTML = html;
                        results.microphone = true;
                    } else {
                        result.innerHTML = '<div class="status error">‚ùå No microphone found<br/>Check: System Settings ‚Üí Microphone</div>';
                        results.microphone = false;
                    }
                    updateSummary();
                })
                .catch(e => {
                    result.innerHTML = '<div class="status error">‚ùå Error: ' + e.message + '</div>';
                    results.microphone = false;
                    updateSummary();
                });
        }

        function testInternet() {
            const result = document.getElementById('internetResult');
            result.innerHTML = '<div class="status info">Testing connection...</div>';
            
            // Test to google.com
            fetch('https://www.google.com', { mode: 'no-cors' })
                .then(() => {
                    result.innerHTML = '<div class="status success">‚úÖ Internet connection working<br/>Google servers reachable</div>';
                    results.internet = true;
                    updateSummary();
                })
                .catch(() => {
                    result.innerHTML = '<div class="status error">‚ùå Cannot reach Google servers<br/>Check your internet connection or firewall</div>';
                    results.internet = false;
                    updateSummary();
                });
        }

        function testSpeechRecognition() {
            const result = document.getElementById('speechResult');
            const output = document.getElementById('speechOutput');
            const btn = document.getElementById('speechBtn');
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                result.innerHTML = '<div class="status error">‚ùå Speech Recognition not supported</div>';
                results.speech = false;
                updateSummary();
                return;
            }

            const recognition = new SpeechRecognition();
            recognition.lang = 'en-US';
            
            result.innerHTML = '<div class="status info">üéôÔ∏è Listening... Speak something!</div>';
            output.style.display = 'block';
            output.innerHTML = 'Waiting for speech...\n';
            btn.disabled = true;
            btn.textContent = 'Listening...';

            recognition.onstart = () => {
                output.innerHTML += 'Speech recognition started\n';
            };

            recognition.onresult = (event) => {
                let transcript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    transcript += event.results[i][0].transcript;
                }
                output.innerHTML += 'Heard: ' + transcript + '\n';
                
                if (event.results[event.results.length - 1].isFinal) {
                    result.innerHTML = '<div class="status success">‚úÖ Speech recognition working!<br/>Heard: "' + transcript + '"</div>';
                    results.speech = true;
                    updateSummary();
                }
            };

            recognition.onerror = (event) => {
                output.innerHTML += 'ERROR: ' + event.error + '\n';
                result.innerHTML = '<div class="status error">‚ùå Speech Recognition Error: ' + event.error + '</div>';
                results.speech = false;
                updateSummary();
            };

            recognition.onend = () => {
                output.innerHTML += 'Speech recognition ended\n';
                btn.disabled = false;
                btn.textContent = 'Start Speech Test';
            };

            try {
                recognition.start();
            } catch (e) {
                result.innerHTML = '<div class="status error">‚ùå Error starting recognition: ' + e.message + '</div>';
                results.speech = false;
                btn.disabled = false;
                btn.textContent = 'Start Speech Test';
                updateSummary();
            }
        }

        // Auto-run browser support test on load
        window.addEventListener('load', () => {
            testBrowserSupport();
        });
    </script>
</body>
</html>
