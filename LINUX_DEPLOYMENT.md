# Linux Deployment Checklist - HTTPS Setup

## ğŸš€ Quick Start (3 Steps)

### Step 1: Generate HTTPS Certificates
```bash
cd /path/to/local_ai
bash setup-https.sh
```

This will:
- âœ… Check prerequisites (openssl)
- âœ… Create SSL directory
- âœ… Generate self-signed certificates
- âœ… Ask for your server IP (optional)
- âœ… Set proper permissions
- âœ… Show next steps

### Step 2: Start Your Services
```bash
# Using Docker Compose
docker-compose up -d

# Or if using Docker directly
docker-compose --profile ssl up -d
```

### Step 3: Access & Test
```
Open browser: https://YOUR_SERVER_IP:443
```

---

## ğŸ“‹ Full Deployment Checklist

### Pre-Deployment
- [ ] Linux server ready (Ubuntu/Debian/CentOS)
- [ ] SSH access to server
- [ ] Know your server's IP address
- [ ] OpenSSL installed: `openssl version`
- [ ] Docker installed: `docker --version`
- [ ] Docker Compose installed: `docker-compose --version`

### Certificate Generation
- [ ] Navigate to project directory: `cd /path/to/local_ai`
- [ ] Run setup script: `bash setup-https.sh`
- [ ] Verify certificates: `ls -la nginx/ssl/`
  - Should show: `cert.pem` and `key.pem`

### Docker Setup
- [ ] Review `docker-compose.yml`
- [ ] Nginx service configured (see below)
- [ ] Ports open: 80 (HTTP) and 443 (HTTPS)
- [ ] Volumes mounted correctly
- [ ] Networks configured

### Nginx Configuration
- [ ] `nginx/nginx.conf` has correct paths
- [ ] SSL certificates path: `/etc/nginx/ssl/`
- [ ] Upstream gateway correct: `gateway:8765`
- [ ] Server name allows all: `server_name _;`

### Firewall/Network
- [ ] Port 80 open (HTTP â†’ HTTPS redirect)
- [ ] Port 443 open (HTTPS)
- [ ] Server IP is accessible from client
- [ ] No firewall blocking ports

### Starting Services
- [ ] Run: `docker-compose up -d`
- [ ] Check status: `docker-compose ps`
- [ ] All containers running (gateway, nginx, etc.)

### Testing
- [ ] HTTPS accessible: `https://SERVER_IP`
- [ ] HTTP redirects to HTTPS: `http://SERVER_IP`
- [ ] Login page loads
- [ ] Run diagnostic: `https://SERVER_IP/static/voice-diagnostic.html`
- [ ] Voice input works (ğŸ¤ button)
- [ ] Voice output works (AI speaks)

### Post-Deployment
- [ ] Set up monitoring/logs
- [ ] Configure backups
- [ ] Document IP and access info
- [ ] Test all features
- [ ] Create user accounts

---

## ğŸ”§ Required Docker Compose Setup

Your `docker-compose.yml` should include an nginx service:

```yaml
version: '3.8'

services:
  gateway:
    # ... your existing gateway config ...
    ports:
      - "8765:8765"
    networks:
      - nora_network

  nginx:
    image: nginx:latest
    container_name: nora_nginx
    restart: unless-stopped
    ports:
      - "80:80"      # HTTP (redirects to HTTPS)
      - "443:443"    # HTTPS
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/ssl:/etc/nginx/ssl:ro
    networks:
      - nora_network
    depends_on:
      - gateway

networks:
  nora_network:
    driver: bridge

volumes:
  ollama_data:
```

---

## ğŸ“ File Structure

Your project should have:
```
local_ai/
â”œâ”€â”€ nginx/
â”‚   â”œâ”€â”€ nginx.conf          # Proxy config
â”‚   â”œâ”€â”€ generate-ssl.sh     # Certificate generator
â”‚   â””â”€â”€ ssl/                # SSL directory (created by script)
â”‚       â”œâ”€â”€ cert.pem        # Certificate
â”‚       â””â”€â”€ key.pem         # Private key
â”œâ”€â”€ gateway/
â”‚   â”œâ”€â”€ server.py
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ ...
â”œâ”€â”€ docker-compose.yml      # Orchestration config
â”œâ”€â”€ setup-https.sh          # Quick setup script
â””â”€â”€ LINUX_HTTPS_SETUP.md    # This guide
```

---

## ğŸš€ Command Reference

### Setup
```bash
# Run setup script
bash setup-https.sh

# Or manually generate certificates
cd nginx
bash generate-ssl.sh
cd ..
```

### Start
```bash
# Start all services
docker-compose up -d

# View logs
docker-compose logs -f

# View specific service logs
docker-compose logs -f nginx
docker-compose logs -f gateway
```

### Stop
```bash
# Stop all services
docker-compose down

# Stop and remove volumes (full cleanup)
docker-compose down -v
```

### Status
```bash
# Check if containers running
docker-compose ps

# Check nginx status
docker exec nora_nginx nginx -T

# Test nginx config
docker exec nora_nginx nginx -t
```

### Troubleshooting
```bash
# View nginx error logs
docker-compose exec nginx tail -f /var/log/nginx/error.log

# Test HTTPS connection
curl -k https://localhost:443

# Check open ports
sudo netstat -tlnp | grep -E ':(80|443)'

# Check if gateway is responding
curl http://localhost:8765/health
```

---

## ğŸ” SSL Certificate Details

### Self-Signed Certificates
- **Generated by:** OpenSSL
- **Valid for:** 365 days
- **Type:** RSA 2048-bit
- **Subject:** Nora AI
- **Locations:** `nginx/ssl/`

### When Certificates Expire
```bash
# Regenerate new certificates
bash setup-https.sh

# Select "yes" to regenerate
# Restart nginx
docker-compose restart nginx
```

### Upgrade to Production Certificates
Optional - for production use Let's Encrypt:
```bash
# On your Linux server
sudo apt-get install certbot python3-certbot-nginx
sudo certbot certonly --standalone -d yourdomain.com

# Update nginx.conf to use the certificates:
ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;
```

---

## ğŸ¤ Voice Feature Requirements Met By HTTPS

With HTTPS enabled:
- âœ… Microphone access allowed
- âœ… Speech Recognition API available
- âœ… Remote access works
- âœ… Voice input functional
- âœ… Voice output functional
- âœ… Audio transcription works
- âœ… All browser security policies satisfied

---

## ğŸ“Š Expected Results

After completing all steps:

```
âœ… Server accessible via HTTPS
âœ… HTTP redirects to HTTPS
âœ… SSL certificate valid (self-signed warning expected)
âœ… Gateway responsive
âœ… Microphone permissions allowed
âœ… Voice input working (ğŸ¤ button active)
âœ… Voice output working (AI speaks)
âœ… All features fully functional
```

---

## ğŸ†˜ Common Issues & Fixes

| Issue | Solution |
|-------|----------|
| `certificate not found` | Run `bash setup-https.sh` |
| `port already in use` | Check: `sudo lsof -i :443` |
| `permission denied` | Use `sudo` for system operations |
| `nginx not starting` | Check: `docker-compose logs nginx` |
| `voice still not working` | Use diagnostic: `https://IP/static/voice-diagnostic.html` |
| `browser warning` | Normal for self-signed certs, click "Advanced" |

---

## ğŸ¯ Next Steps After Setup

1. âœ… Complete deployment checklist
2. âœ… Test all features work
3. âœ… Create user accounts
4. âœ… Set up monitoring/backups
5. âœ… Document access information
6. âœ… Train users on features

---

## ğŸ“ Additional Resources

- `LINUX_HTTPS_SETUP.md` - Detailed HTTPS guide
- `VOICE_TROUBLESHOOTING.md` - Voice feature help
- `COMPLETE_FEATURES_GUIDE.md` - Feature documentation
- Nginx docs: https://nginx.org/
- Let's Encrypt: https://letsencrypt.org/

---

**Linux Deployment Ready!** ğŸš€

Run `bash setup-https.sh` to get started.
